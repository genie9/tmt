csr bmad bmad implement csr algorithm beam particl divid number bin contribut particl bin total charg determin overlap particl triangular charg distribut bin algorithm simul csr longitudin space charg sc implement part bmad subroutin librari relativist charg particl simul bmad simul beam set particl beam track lattic element divid element number slice track slice involv first propag particl independ appli csr sc energi kick calcul energi kick beam divid longitudin bin shown fig comput charg bin beam particl consid triangular charg distribut overlap triangular charg distribut bin determin particl contribut total charg bin width particl triangular charg distribut number bin set user bin width dynam adjust time step bin span bunch length increas particl width smooth distribut cost resolut charg densiti center bin taken total charg within bin bin width charg densiti assum vari linear bin center csr energi kick particl center bin travel distanc accord eq evalu involv invers eq obtain monoton function newton method use find number bracket root ridder method use quick find deriv eq approxim use general excel approxim except shown fig howev integr done exact assum sourc kick point lie within element energi kick center bin calcul energi kick appli particl calcul via interpol assum linear variat kick bin center calcul energi kick comput time calcul charg bin charg scale number particl simul comput time calcul energi kick bin center scale time calcul energi kick particl scale chamber wall simul incorpor shield top bottom chamber wall use imag current appendix explain neglect width chamber good approxim width larger hight imag current well separ actual beam singular deal subtract straight forward integr done use eq eq charg bin chamber height index imag current vertic displac number imag charg need chosen larg enough neglect imag current signific effect simul result relev angl small imag charg kick must calcul without small angl approxim eq
